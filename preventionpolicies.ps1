#Initialize USB device policy Description, API keys, and declare TLS method
$description="Sandisk"
$descriptionFormated=$description.ToLower()
$myclientId = "<YOUR_API_CLIENT_KEY>"
$myClientSecret = "<YOUR_API_SECRET>"
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

#Oauth Authentication / Replace ClientID and secret
$headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
$headers.Add("Content-Type", "application/x-www-form-urlencoded")
$body = "client_id=$myclientId&client_secret=$myClientSecret"
$response = Invoke-RestMethod "https://api.crowdstrike.com/oauth2/token?clientId=$myclientId&clientSecret=$myClientSecret" -Method 'POST' -Headers $headers -Body $body
$response | ConvertTo-Json
$BearerToken = $response.access_token


#New Policy for PoV Best Practice no Quarantine
$headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
$headers.Add("Content-Type", "application/json")
$headers.Add("Accept", "application/json")
$headers.Add("Authorization", "Bearer $BearerToken")
$body = "{`n  `"resources`": [`n    {`n      `"description`": `"POV Best Practices No Quarantine`",`n      `"name`": `"POV Best Practices No Quarantine`",`n      `"platform_name`": `"Windows`",`n      `"settings`": [`n        {`n          `"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n        },`n`n        {`n			`"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownDetectionRelatedExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SensorTamperingProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"AdditionalUserModeData`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"InterpreterProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"EngineProtectionV2`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ScriptBasedExecutionMonitoring`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"HTTPDetections`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"RedactHTTPDetectionDetails`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"HardwareEnhancedExploitDetection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FirmwareAnalysisExtraction`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"CloudAntiMalware`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"AdwarePUP`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"OnSensorMLSlider`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"DetectOnWrite`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"QuarantineOnWrite`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"NextGenAV`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"CustomBlacklisting`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"PreventSuspiciousProcesses`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SuspiciousRegistryOperations`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"MaliciousPowershell`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"IntelPrevention`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SuspiciousKernelDrivers`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ForceASLR`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ForceDEP`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"HeapSprayPreallocation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"NullPageAllocation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SEHOverwriteProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"BackupDeletion`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"Cryptowall`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FileEncryption`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"Locky`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FileSystemAccess`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyAudit`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyProtect`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ApplicationExploitationActivity`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ChopperWebshell`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"DriveByDownload`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {				  `n			`"id`": `"ProcessHollowing`",				  `n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"JavaScriptViaRundll32`",					`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"WindowsLogonBypassStickyKeys`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"CredentialDumping`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"AutomatedRemediation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		}`n      ]`n    }`n  ]`n}"
$response = Invoke-RestMethod 'https://api.crowdstrike.com/policy/entities/prevention/v1' -Method 'POST' -Headers $headers -Body $body
$response | ConvertTo-Json




#New Policy for PoV Blocking strong
$headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
$headers.Add("Content-Type", "application/json")
$headers.Add("Accept", "application/json")
$headers.Add("Authorization", "Bearer $BearerToken")
$body = "{`n  `"resources`": [`n    {`n      `"description`": `"POV Blocking Strong`",`n      `"name`": `"POV Blocking Strong`",`n      `"platform_name`": `"Windows`",`n      `"settings`": [`n        {`n          `"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n        },`n`n        {`n			`"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownDetectionRelatedExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SensorTamperingProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"AdditionalUserModeData`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"InterpreterProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"EngineProtectionV2`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ScriptBasedExecutionMonitoring`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"HTTPDetections`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"RedactHTTPDetectionDetails`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"HardwareEnhancedExploitDetection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FirmwareAnalysisExtraction`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"CloudAntiMalware`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"AdwarePUP`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"OnSensorMLSlider`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"DetectOnWrite`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"QuarantineOnWrite`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"NextGenAV`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"CustomBlacklisting`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"PreventSuspiciousProcesses`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SuspiciousRegistryOperations`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"MaliciousPowershell`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"IntelPrevention`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SuspiciousKernelDrivers`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ForceASLR`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ForceDEP`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"HeapSprayPreallocation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"NullPageAllocation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SEHOverwriteProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"BackupDeletion`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"Cryptowall`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FileEncryption`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"Locky`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FileSystemAccess`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyAudit`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyProtect`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ApplicationExploitationActivity`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ChopperWebshell`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"DriveByDownload`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {				  `n			`"id`": `"ProcessHollowing`",				  `n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"JavaScriptViaRundll32`",					`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"WindowsLogonBypassStickyKeys`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"CredentialDumping`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"AutomatedRemediation`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		}`n `n      ]`n    }`n  ]`n}"
$response = Invoke-RestMethod 'https://api.crowdstrike.com/policy/entities/prevention/v1' -Method 'POST' -Headers $headers -Body $body
$response | ConvertTo-Json

#New Policy for PoV Detection Only
$headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
$headers.Add("Content-Type", "application/json")
$headers.Add("Accept", "application/json")
$headers.Add("Authorization", "Bearer $BearerToken")
$body = "{`n  `"resources`": [`n    {`n      `"description`": `"POV Detect Only`",`n      `"name`": `"POV Detect Only`",`n      `"platform_name`": `"Windows`",`n      `"settings`": [`n        {`n          `"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n        },`n`n        {`n			`"id`": `"EndUserNotifications`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownDetectionRelatedExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"UnknownExecutables`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"SensorTamperingProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"AdditionalUserModeData`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"InterpreterProtection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"EngineProtectionV2`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"ScriptBasedExecutionMonitoring`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"HTTPDetections`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"RedactHTTPDetectionDetails`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"HardwareEnhancedExploitDetection`",`n					`"value`": {`n				  	`"enabled`": true`n				  }`n		},`n        {`n			`"id`": `"FirmwareAnalysisExtraction`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"CloudAntiMalware`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"DISABLED`"`n				  }`n		},`n        {`n			`"id`": `"AdwarePUP`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"DISABLED`"`n				  }`n		},`n        {`n			`"id`": `"OnSensorMLSlider`",`n					`"value`": {`n				  	`"detection`": `"AGGRESSIVE`",`n				  	`"prevention`": `"AGGRESSIVE`"`n				  }`n		},`n        {`n			`"id`": `"DetectOnWrite`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"QuarantineOnWrite`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"NextGenAV`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"CustomBlacklisting`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"PreventSuspiciousProcesses`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"SuspiciousRegistryOperations`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"MaliciousPowershell`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"IntelPrevention`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"SuspiciousKernelDrivers`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"ForceASLR`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"ForceDEP`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"HeapSprayPreallocation`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"NullPageAllocation`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"SEHOverwriteProtection`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"BackupDeletion`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"Cryptowall`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"FileEncryption`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"Locky`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"FileSystemAccess`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyAudit`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"VolumeShadowCopyProtect`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"ApplicationExploitationActivity`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"ChopperWebshell`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"DriveByDownload`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {				  `n			`"id`": `"ProcessHollowing`",				  `n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"JavaScriptViaRundll32`",					`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"WindowsLogonBypassStickyKeys`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"CredentialDumping`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		},`n        {`n			`"id`": `"AutomatedRemediation`",`n					`"value`": {`n				  	`"enabled`": false`n				  }`n		}`n `n      ]`n    }`n  ]`n}"
$response = Invoke-RestMethod 'https://api.crowdstrike.com/policy/entities/prevention/v1' -Method 'POST' -Headers $headers -Body $body
$response | ConvertTo-Json
